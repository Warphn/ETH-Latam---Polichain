generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                 String            @id @default(cuid())
  createdAt          DateTime          @default(now())
  baseAccountAddress String            @unique
  subAccountAddress  String?           @unique
  youtubeId          String?           @unique
  permissions        SpendPermission[]

  initiatedPreferences Preference[] @relation("InitiatorConnections")
  targettedPreferences Preference[] @relation("TargetConnections")
  @@index([baseAccountAddress])
  @@index([subAccountAddress])
}

model Preference {
  id               String    @id @default(cuid())
    userId           String
  user             User      @relation("InitiatorConnections", fields: [userId], references: [id])
  userPreferenceId String
  userPreference   User      @relation("TargetConnections", fields: [userPreferenceId], references: [id])
  @@unique([userId, userPreferenceId]) // Opcional, mas Ãºtil
  @@index([userId])
  @@index([userPreferenceId])
}
model SpendPermission {
  permissionHash String    @id
  createdAt      DateTime  @default(now())
  revokedAt      DateTime?
  userId         String
  ownerAccount   String
  spender        String
  token          String
  allowance      Decimal   @db.Decimal(78, 0)
  periodSeconds  Int
  startTs        BigInt
  endTs          BigInt
  salt           String
  extraData      Bytes?
  signature      Bytes
  chainId        Int
  user           User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([ownerAccount])
  @@index([spender])
  @@index([token])
  @@index([chainId])
}

model ServerWallet {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  label     String
  address   String   @unique
  chainId   Int
  active    Boolean  @default(true)

  @@index([label])
  @@index([chainId])
}
